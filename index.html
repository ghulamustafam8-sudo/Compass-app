<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Advanced Compass — GMS</title>

  <meta name="description" content="Advanced web compass with calibration, logging, true/magnetic toggle, declination correction and accessibility features.">
  <meta name="theme-color" content="#07162a">

  <!-- External stylesheet (will provide when you say "CSS do") -->
  <link rel="stylesheet" href="style.css">

  <!-- PWA & icons (optional; placeholders) -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/favicon-32.png" sizes="32x32">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
</head>
<body>
  <header class="app-header" role="banner" aria-label="Compass application header">
    <div class="container header-inner">
      <h1 class="app-title">Advanced Compass</h1>
      <p class="app-subtitle">High-precision web compass — tap Request Motion on mobile or use mouse to simulate.</p>

      <nav aria-label="Primary controls" class="top-controls">
        <button id="btn-request" type="button" aria-pressed="false">Request Motion</button>
        <button id="btn-calibrate" type="button">Calibrate</button>
        <button id="btn-settings" type="button" aria-haspopup="dialog" aria-controls="settings-dialog">Settings</button>
        <button id="btn-help" type="button" aria-haspopup="dialog" aria-controls="help-dialog">Help</button>
      </nav>
    </div>
  </header>

  <main id="main" class="container" role="main">
    <section aria-labelledby="compass-region-title" class="compass-region">
      <h2 id="compass-region-title" class="visually-hidden">Compass</h2>

      <article class="compass-card" aria-label="Compass instrument" role="region" data-js-compass>
        <div class="compass-wrap" id="compass-wrap">
          <div class="compass-viewport" role="application" aria-roledescription="interactive compass">
            <!-- Scalable SVG compass face (visuals applied via CSS) -->
            <svg id="compass-svg" viewBox="0 0 400 400" role="img" aria-label="Compass face" focusable="false">
              <defs>
                <linearGradient id="g-needle" x1="0" x2="0" y1="0" y2="1">
                  <stop offset="0" stop-color="#ffffff" stop-opacity="1"/>
                  <stop offset="1" stop-color="#a8f0f8" stop-opacity="0.85"/>
                </linearGradient>
                <filter id="f-shadow" x="-50%" y="-50%" width="200%" height="200%">
                  <feDropShadow dx="0" dy="6" stdDeviation="8" flood-opacity="0.12"/>
                </filter>
              </defs>

              <!-- bezel -->
              <circle cx="200" cy="200" r="190" class="bezel" />

              <!-- ticks group (will be filled/styled by CSS or JS) -->
              <g id="ticks" aria-hidden="true"></g>

              <!-- cardinal letters -->
              <g id="cardinals" font-family="sans-serif" font-weight="700" font-size="28" text-anchor="middle" fill="#dff3fb">
                <text x="200" y="45">N</text>
                <text x="355" y="210">E</text>
                <text x="200" y="370">S</text>
                <text x="45"  y="210">W</text>
              </g>

              <!-- needle group (rotated by JS) -->
              <g id="needle-group" transform="translate(200,200)" aria-hidden="true">
                <ellipse cx="0" cy="80" rx="10" ry="28" class="needle-tail" />
                <path d="M0,-8 L6,-160 L0,-140 L-6,-160 Z" class="needle-red" />
                <path d="M0,8 L6,160 L0,140 L-6,160 Z" class="needle-white" />
                <circle cx="0" cy="0" r="10" class="pivot" />
              </g>

              <!-- center text -->
              <g id="center-labels">
                <text x="200" y="220" text-anchor="middle" class="heading-num" id="heading-display">—°</text>
                <text x="200" y="245" text-anchor="middle" class="heading-dir" id="dir-display">Direction: —</text>
              </g>
            </svg>
          </div>

          <div class="compass-fallback" id="compass-fallback" aria-hidden="false">
            <p>Move your mouse over the compass or enable device motion on mobile.</p>
          </div>
        </div>

        <div class="compass-info" role="status" aria-live="polite">
          <div class="info-row">
            <span id="status-text">Status: waiting for sensor / input</span>
            <span class="spacer" aria-hidden="true"></span>
            <span id="permission-indicator" aria-hidden="true">●</span>
          </div>

          <dl class="readouts" aria-label="Readouts">
            <div>
              <dt>Heading</dt>
              <dd id="heading-dd">—°</dd>
            </div>
            <div>
              <dt>Cardinal</dt>
              <dd id="cardinal-dd">—</dd>
            </div>
            <div>
              <dt>Accuracy</dt>
              <dd id="accuracy-dd">—</dd>
            </div>
            <div>
              <dt>Mode</dt>
              <dd id="mode-dd">Magnetic</dd>
            </div>
          </dl>

          <div class="controls-inline">
            <label for="declination" class="sr-only">Magnetic declination degrees</label>
            <input id="declination" type="number" step="0.1" inputmode="decimal" aria-label="Magnetic declination in degrees" placeholder="Declination (°)">
            <button id="apply-decl" type="button">Apply</button>

            <label class="switch">
              <input type="checkbox" id="toggle-true" aria-label="Use true north">
              <span class="switch-label">Use True North</span>
            </label>
          </div>
        </div>
      </article>
    </section>

    <section class="history-region" aria-labelledby="history-title">
      <h2 id="history-title">History &amp; Logs</h2>
      <p class="muted">Recent headings — tap an entry to pin it.</p>

      <ul id="log-list" class="log-list" aria-live="polite" role="list"></ul>

      <div class="history-actions">
        <button id="btn-clear-log" type="button">Clear Log</button>
        <button id="btn-export-log" type="button">Export CSV</button>
      </div>
    </section>

    <section class="extras-region" aria-labelledby="extras-title">
      <h2 id="extras-title">Extras</h2>

      <div class="extras-grid">
        <div class="card small">
          <h3>Calibration Guide</h3>
          <ol>
            <li>Tap <strong>Calibrate</strong>.</li>
            <li>Rotate device slowly in all axes.</li>
            <li>Stop when accuracy stabilizes.</li>
          </ol>
        </div>

        <div class="card small">
          <h3>Sensor Diagnostics</h3>
          <p id="sensor-diagnostics">No data</p>
          <button id="btn-run-diagnostics" type="button">Run Diagnostics</button>
        </div>

        <div class="card small">
          <h3>Export</h3>
          <p>Save log for analysis or share.</p>
          <button id="btn-share" type="button">Share</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Settings dialog -->
  <dialog id="settings-dialog" aria-labelledby="settings-title">
    <h3 id="settings-title">Settings</h3>
    <form method="dialog" id="settings-form">
      <label>Units:
        <select id="units-select" name="units">
          <option value="deg">Degrees (°)</option>
          <option value="mil">Mils</option>
        </select>
      </label>

      <label>Tick density:
        <input id="tick-density" name="tickDensity" type="range" min="4" max="36" value="36">
      </label>

      <label>Log size:
        <input id="log-size" name="logSize" type="number" min="10" max="1000" value="100">
      </label>

      <menu>
        <button id="settings-close" type="button">Close</button>
        <button id="settings-save" type="submit">Save</button>
      </menu>
    </form>
  </dialog>

  <!-- Help dialog -->
  <dialog id="help-dialog" aria-labelledby="help-title">
    <h3 id="help-title">Help &amp; Tips</h3>
    <p>Mobile: Allow motion access when prompted. iOS requires explicit permission.</p>
    <p>Desktop: Move mouse across the compass to simulate heading.</p>
    <menu>
      <button id="help-close" type="button">Close</button>
    </menu>
  </dialog>

  <footer class="app-footer" role="contentinfo">
    <div class="container">
      <small>Made by <strong>Ghulam Mustafa Siddiqui</strong> — edit the single-file app. Version: 1.0.0</small>
    </div>
  </footer>

  <!-- Accessibility helpers references (no inline styles) -->
  <noscript>
    <div role="alert" style="padding:12px;background:#fee; color:#600;">
      JavaScript is required for full functionality. Please enable JS.
    </div>
  </noscript>

  <!-- External script (will provide when you say "JS do") -->
  <script src="script.js" defer></script>
</body>
</html>
